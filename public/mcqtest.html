<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>MCQ ‡¶ï‡ßã‡¶∞‡ßç‡¶∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Anek+Bangla:wght@100..800&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'Anek Bangla', sans-serif;
      background: #f0f2f5;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      padding: 1rem;
    }
    .course-info {
      text-align: center;
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    .course-info h1 {
      font-size: 22px;
      margin-bottom: 0.5rem;
    }
    .course-info p {
      margin: 0.5rem 0;
    }
    .buy-button {
      background: #28a745;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .layout {
      display: flex;
      gap: 1rem;
    }

    .sidebar {
      width: 250px;
    }

    .subject-group {
      background: #2d2f36;
      color: white;
      margin-bottom: 0.5rem;
      border-radius: 6px;
    }

    .subject-toggle {
      width: 100%;
      background: #2d2f36;
      color: white;
      padding: 10px;
      border: none;
      text-align: left;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
    }

    .test-list {
      display: none;
      background: #f5f5f5;
      padding: 10px;
      border-top: 1px solid #ccc;
    }

    .test-list button {
      display: block;
      width: 100%;
      padding: 8px;
      margin-bottom: 5px;
      background: #e0e0e0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-align: left;
    }

    .test-details {
      flex-grow: 1;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      min-height: 200px;
    }

    .start-button {
      margin-top: 1rem;
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }

    .start-button.disabled {
      opacity: 0.6;
      pointer-events: none;
      cursor: not-allowed;
    }

    #paymentSection {
      display: none;
      margin-top: 1rem;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    #paymentSection input,
    #paymentSection select {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    #paymentMessage {
      margin-top: 10px;
      font-weight: bold;
      text-align: center;
    }

    @media screen and (max-width: 768px) {
      .layout {
        flex-direction: column;
        align-items: center;
      }
      .sidebar {
        width: 100%;
      }
      .test-list button, .subject-toggle {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="course-info">
      <h1>MCQ ‡¶ï‡ßã‡¶∞‡ßç‡¶∏: ‡¶≠‡¶∞‡ßç‡¶§‡¶ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡¶ø</h1>
      <p>‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß™‡ßØ‡ßØ ‡¶ü‡¶æ‡¶ï‡¶æ</p>
      <p>‡¶è‡¶á ‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡ßá ‡¶•‡¶æ‡¶ï‡¶õ‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶∑‡ßü‡ßá‡¶∞ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï MCQ ‡¶Ö‡¶®‡ßÅ‡¶∂‡ßÄ‡¶≤‡¶® ‡¶ì ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ‡•§</p>
      <button class="buy-button" onclick="handleBuyNow()">‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡¶ü‡¶ø ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>

      <div id="paymentSection">
        <h3>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
        <p>‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶¨‡¶æ ‡¶®‡¶ó‡¶¶ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá ‡ß™‡ßØ‡ßØ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        <select id="method" onchange="updateInstructions()">
          <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
          <option value="nagad">‡¶®‡¶ó‡¶¶</option>
        </select>
        <div id="instructions" style="margin: 5px 0; font-size: 14px; color: #333;"></div>
        <input type="text" id="phone" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" />
        <input type="text" id="trxid" placeholder="‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (TrxID)" />
        <button onclick="submitPayment()" class="buy-button">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <div id="paymentMessage"></div>
      </div>
    </div>

    <div class="layout">
      <div class="sidebar">
        <div class="subject-group">
          <button class="subject-toggle">‡¶ó‡¶£‡¶ø‡¶§</button>
          <div class="test-list">
            <!-- ‡¶è‡¶ñ‡¶æ‡¶®‡ßá data-‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßç‡¶∞‡¶ø‡¶¨‡¶ø‡¶â‡¶ü ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü, ‡¶ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶ü‡¶æ‡¶∞, ‡¶∏‡¶Æ‡ßü, ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶∏ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã -->
            <button onclick="showTestDetails(this)" 
              data-subject="math" 
              data-chapter="math-1" 
              data-time="30" 
              data-question="30"
              data-mark="30">Model Test 1</button>
            <button onclick="showTestDetails(this)" 
              data-subject="‡¶ó‡¶£‡¶ø‡¶§" 
              data-chapter="‡¶Æ‡¶°‡ßá‡¶≤ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡ß®" 
              data-time="‡ß©‡ß¶" 
              data-question="20"
              data-mark="‡ß®‡ß´">Model Test 2</button>
    
          </div>
        </div>
        <div class="subject-group">
          <button class="subject-toggle">‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•</button>
          <div class="test-list">
            <button onclick="showTestDetails(this)" 
              data-subject="‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•" 
              data-chapter="‡¶Æ‡¶°‡ßá‡¶≤ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡ßß" 
              data-time="‡ß©‡ß¶" 
              data-mark="‡ß®‡ß´">Model Test 1</button>
          </div>
        </div>
      </div>

      <div class="test-details" id="testDetails">
        <h2>‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡¶°‡ßá‡¶≤ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®‡•§</p>
      </div>
    </div>
  </div>

  <script>
    // ‡¶∏‡¶æ‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ü‡¶ó‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßã
    document.querySelectorAll('.subject-toggle').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.test-list').forEach(list => {
          if (list !== button.nextElementSibling) {
            list.style.display = 'none';
          }
        });
        const panel = button.nextElementSibling;
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
      });
    });

    // ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®, ‡¶Ø‡ßá‡¶ü‡¶æ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ data-‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßç‡¶∞‡¶ø‡¶¨‡¶ø‡¶â‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡ßü
    function showTestDetails(button) {
      const subject = button.getAttribute('data-subject');
      const chapter = button.getAttribute('data-chapter');
      const time = button.getAttribute('data-time');
      const mark = button.getAttribute('data-mark');
      const question = button.getAttribute('data-question'); // ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ, ‡¶Ø‡¶¶‡¶ø ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶π‡ßü
      const user = JSON.parse(localStorage.getItem('user'));
      const testDetails = document.getElementById('testDetails');

      testDetails.innerHTML = `
        <h2>${subject} - ${chapter}</h2>
        <p>‡¶è‡¶á ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡ßü ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ${mark}‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡•§ ‡¶∏‡¶Æ‡ßü: ${time} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡•§ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡•§</p>
        <a href="mcqexam.html?subject=${encodeURIComponent(subject)}&chapter=${encodeURIComponent(chapter)}&time=${time}&mark=${mark}&data-question=${question}&random=true" 
           id="startTestBtn" 
           class="start-button disabled"
           >üü¢ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
        <div id="startMessage" style="margin-top: 10px; font-weight: bold;"></div>
      `;

      window.scrollTo({ top: testDetails.offsetTop - 30, behavior: 'smooth' });

      checkTestAccess(user);
    }

    // ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶¨‡¶æ ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶ï‡¶∞‡¶¨‡ßá
    async function checkTestAccess(user) {
      const btn = document.getElementById('startTestBtn');
      const msg = document.getElementById('startMessage');

      if (!user) {
        msg.textContent = "‚ö†Ô∏è ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§";
        btn.classList.add('disabled');
        btn.removeAttribute('href');
        return;
      }

      try {
        const res = await fetch('/api/payments/all');
        const payments = await res.json();

        const match = payments.find(p =>
          p.phone === user.phone &&
          p.courseId === 'mcq_course' &&
          p.status === 'approved'
        );

        if (match) {
          msg.textContent = "‚úÖ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§";
          btn.classList.remove('disabled');
          // href ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, ‡¶§‡¶æ‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
        } else {
          msg.textContent = "‚õî ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶ñ‡¶®‡ßã ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶π‡ßü‡¶®‡¶ø ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§";
          btn.classList.add('disabled');
          btn.removeAttribute('href');
        }
      } catch (err) {
        msg.textContent = "‚ùå ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§";
        btn.classList.add('disabled');
        btn.removeAttribute('href');
      }
    }

    function handleBuyNow() {
      const user = JSON.parse(localStorage.getItem('user'));
      if (!user) {
        alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ü‡¶ó‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§");
        return;
      }
      const section = document.getElementById('paymentSection');
      section.style.display = (section.style.display === 'block') ? 'none' : 'block';
    }

    function updateInstructions() {
      const method = document.getElementById('method').value;
      const instructions = document.getElementById('instructions');
      instructions.textContent = method === 'bkash'
        ? '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá Send Money ‡¶ï‡¶∞‡ßÅ‡¶®: 01XXXXXXXXX'
        : '‡¶®‡¶ó‡¶¶ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá Send Money ‡¶ï‡¶∞‡ßÅ‡¶®: 01YYYYYYYYY';
    }

    async function submitPayment() {
      const user = JSON.parse(localStorage.getItem('user'));
      const method = document.getElementById('method').value;
      const phone = document.getElementById('phone').value.trim();
      const trxid = document.getElementById('trxid').value.trim();
      const messageEl = document.getElementById('paymentMessage');

      if (!method || !phone || !trxid) {
        messageEl.textContent = "‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
        messageEl.style.color = 'red';
        return;
      }

      if (!/^01[0-9]{9}$/.test(phone)) {
        messageEl.style.color = 'red';
        messageEl.textContent = "‡¶∏‡¶†‡¶ø‡¶ï ‡ßß‡ßß ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®‡•§";
        return;
      }

      const payload = {
        courseId: 'mcq_course price_499',
        name: user.name,
        phone: user.phone,
        email: user.email || '',
        paymentMethod: method,
        paymentPhone: phone,
        transactionId: trxid
      };

      try {
        const res = await fetch('/api/payments/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        if (res.ok) {
          messageEl.style.color = 'green';
          messageEl.textContent = '‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
          document.getElementById('paymentSection').style.display = 'none';
        } else {
          messageEl.style.color = 'red';
          messageEl.textContent = data.error || '‚ùå ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
        }
      } catch (err) {
        messageEl.style.color = 'red';
        messageEl.textContent = '‚ùå ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§';
      }
    }

    async function checkBuyButtonStatus() {
      const user = JSON.parse(localStorage.getItem('user'));
      const buyBtn = document.querySelector('.buy-button');

      if (!user) return;

      try {
        const res = await fetch('/api/payments/all');
        const payments = await res.json();

        const match = payments.find(p =>
          p.phone === user.phone &&
          p.courseId === 'mcq_course' &&
          p.status === 'approved'
        );

        if (match) {
          buyBtn.textContent = "‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®";
          buyBtn.onclick = () => {
            window.location.href = "#"; // ‡¶ï‡ßã‡¶∞‡ßç‡¶∏ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßá‡¶á‡¶ú‡ßá‡¶∞ URL ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶ì
          };
        }
      } catch (err) {
        console.error("‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:", err);
      }
    }

    window.onload = () => {
      updateInstructions();
      checkBuyButtonStatus();
    };
  </script>
</body>
</html>
